<!--
* Copyright (c) 2010 The Chromium Authors. All rights reserved.  Use of this
* source code is governed by a BSD-style license that can be found in the
* LICENSE file.
*
* Author: Eric Bidelman <ericbidelman@chromium.org>
-->
<html>
  <head>
    <title>Options</title>
    <style type="text/css">
      body, table {
        font-family: Helvetica, Arial, sans-serif;
        font-size: small;
      }
    </style>
    <script type="text/javascript">
      var bgPage = chrome.extension.getBackgroundPage();

      function logout() {
        bgPage.logout();
        location.reload();
      }

      function setupSync() {
        try {
          if(!bgPage.oauth.hasToken()) {
            alert('Set up authentication first.');
            return;
          }
          if(!localStorage.gDoc) {
            gDoc = new bgPage.GoogleDoc();
            gDoc.getDocByName(bgPage.REMOTE_DOC_NAME);
            if(!localStorage.gDoc) {
              gDoc.createNewDoc(bgPage.REMOTE_DOC_NAME);
            }
          }
        } catch (e) {
          alert(e);
        }
        location.reload();
      }

      function clearSync() {
        localStorage.removeItem('gDoc');
        location.reload();
      }

      function clearLocalData() {
        localStorage.removeItem('pagenotes');
        location.reload();
      }

      function initUI() {
        if (!bgPage.oauth.hasToken()) {
          document.getElementById('revoke').disabled = true;
        } else {
          document.getElementById('get_auth_token').disabled = true;
        }
        if (localStorage.gDoc) {
          document.getElementById('setup_sync').disabled = true;
        } else {
          document.getElementById('clear_sync').disabled = true;
        }
        if (!localStorage.pagenotes) {
          document.getElementById('clear_local').disabled = true;
        }
        if (localStorage.lastSyncStatus) {
          document.getElementById('sync_status').innerHTML = localStorage.lastSyncStatus;
          document.getElementById('local_last_mod_time').innerHTML = localStorage.lastModTime;
          document.getElementById('remote_last_mod_time').innerHTML = bgPage.getRemoteLastModTime();
        }
        if (bgPage.debug.msg){
          document.getElementById('debug').innerHTML = bgPage.debug.msg;
        }
      }
    </script>
  </head>
  <body onload="initUI();">

    <table>
      <tr>
        <td>Sync Status</td>
        <td id="sync_status"></td>
      </tr>
      <tr>
        <td>Local Last Mod Time</td>
        <td id="local_last_mod_time"></td>
      </tr>
      <tr>
        <td>Remote Last Mod Time</td>
        <td id="remote_last_mod_time"></td>
      </tr>
    </table>
    <p>
      <button id="clear_local" onclick="clearLocalData();">
        Clear Local Data
      </button>
    </p>
    <p>
      <button id="setup_sync" onclick="setupSync();">
        Setup Sync
      </button>
      <button id="clear_sync" onclick="clearSync();">
        Clear Sync
      </button>
    </p>
    <p>
      Authentication Settings:
    </p>
    <p style="margin-left:10px; margin-top:10px">
      <button id="get_auth_token" onclick="bgPage.oauth.authorize(function(){location.reload();});">
        Get Google Docs OAuth Token
      </button>
      <button id="revoke" onclick="logout();clearSync();">
        Revoke Google Docs OAuth Token
      </button>
    </p>
    <pre id="debug"></pre>
  </body>
</html>

